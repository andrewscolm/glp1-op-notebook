str_detect(bnf_name,"Rybelsus")~"Rybelsus",
str_detect(bnf_name,"Wegovy")~"Wegovy"))
View(df_semaglutide_names)
df_semaglutide_names[1]
df_semaglutide_names[1:10]
df_semaglutide_names[1:29]
df_semaglutide_names[1:23]
View(df_semaglutide_names[1:23])
df_semaglutide_names
df_semaglutide <- df_input %>%
filter(drug=="Semaglutide") %>%
filter(!str_detect(bnf_name,"tablet"))
df_semaglutide_names <- df_semaglutide %>%
group_by(bnf_name) %>%
summarise() %>%
pull(bnf_name)
df_semaglutide_names
df_semaglutide <- df_semaglutide %>%
mutate(brand = case_when(
str_detect(bnf_name,"Ozempic")~"Ozempic",
str_detect(bnf_name,"Rybelsus")~"Rybelsus",
str_detect(bnf_name,"0.25mg/0.37ml inj 1.5ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"0.5mg/0.37ml inj 1.5ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1.7mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"2.4mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.19ml inj 1.5ml pre-filled pens")~"Ozempic",
str_detect(bnf_name,"0.5mg/0.37ml inj 1.5ml pre-filled pens")~"Ozempic / Wegovy",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled pens")~"Ozempic"
)    )
df_semaglutide <- df_semaglutide %>%
mutate(brand = case_when(
str_detect(bnf_name,"Ozempic")~"Ozempic",
str_detect(bnf_name,"Rybelsus")~"Rybelsus",
str_detect(bnf_name,"Wegovy")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.37ml inj 1.5ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1.7mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"2.4mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.19ml inj 1.5ml pre-filled pens")~"Ozempic",
str_detect(bnf_name,"0.5mg/0.37ml inj 1.5ml pre-filled pens")~"Ozempic / Wegovy",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled pens")~"Ozempic"
)    )
df_semaglutide %>%
filter(is.na(brand)) %>%
group_by(bnf_name) %>%
summarise() %>%
pull(bnf_name)
# read OP data
df_input <- read_csv(here::here("data","vtm_matched.csv"))
# combine with region name
df_regions <- read_csv(here::here("data","NHS_England_Names_and_Codes_in_England.csv")) %>%
rename(regional_team = NHSER24CDH ,region = NHSER24NM) %>%
select(regional_team,region)
df_input <- df_input %>%
left_join(df_regions)
df_semaglutide <- df_input %>%
filter(drug=="Semaglutide")
df_semaglutide_names <- df_semaglutide %>%
group_by(bnf_name) %>%
summarise() %>%
pull(bnf_name)
df_semaglutide_names
# Check all names have a brand
df_semaglutide %>%
filter(is.na(brand)) %>%
group_by(bnf_name) %>%
summarise() %>%
pull(bnf_name)
library(scales)
library(readr)
library('tidyverse')
library('sf')
library(ggplot2)
library(stringr)
library(here)
library("glue")
# read OP data
df_input <- read_csv(here::here("data","vtm_matched.csv"))
# combine with region name
df_regions <- read_csv(here::here("data","NHS_England_Names_and_Codes_in_England.csv")) %>%
rename(regional_team = NHSER24CDH ,region = NHSER24NM) %>%
select(regional_team,region)
df_input <- df_input %>%
left_join(df_regions)
### filter out tablets (note Rybelsus only available in tablet form)
df_semaglutide <- df_input %>%
filter(drug=="Semaglutide") %>%
filter(!str_detect(bnf_name,"tablet"))
df_semaglutide_names <- df_semaglutide %>%
group_by(bnf_name) %>%
summarise() %>%
pull(bnf_name)
#### referencing against OP dmd browser https://openprescribing.net/dmd/?q=0601023AW to find brand
#### note 0.5mg/0.37ml inj 1.5ml can be either Ozempic or Wegovy
df_semaglutide <- df_semaglutide %>%
mutate(brand = case_when(
str_detect(bnf_name,"Ozempic")~"Ozempic",
str_detect(bnf_name,"Rybelsus")~"Rybelsus",
str_detect(bnf_name,"Wegovy")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.19ml inj 1.5ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.37ml inj 1.5ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.37ml inj 1.5ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1.7mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1.7mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"1mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"Semaglutide 1mg/0.75ml inj 3ml pre-filled disposable devices")~"Wegovy",
str_detect(bnf_name,"1mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"2.4mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"2.4mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.19ml inj 1.5ml pre-filled pens")~"Ozempic",
str_detect(bnf_name,"0.5mg/0.37ml inj 1.5ml pre-filled pens")~"Ozempic / Wegovy",
str_detect(bnf_name,"0.5mg/0.37ml inj 1.5ml pf dispos dev")~"Ozempic / Wegovy",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled pens")~"Ozempic",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled disposable devices")~"Ozempic",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled pens")~"Ozempic"
)    )
# Check all names have a brand
df_semaglutide %>%
filter(is.na(brand)) %>%
group_by(bnf_name) %>%
summarise() %>%
pull(bnf_name)
#### referencing against OP dmd browser https://openprescribing.net/dmd/?q=0601023AW to find brand
#### note 0.5mg/0.37ml inj 1.5ml can be either Ozempic or Wegovy
df_semaglutide <- df_semaglutide %>%
mutate(brand = case_when(
str_detect(bnf_name,"Ozempic")~"Ozempic",
str_detect(bnf_name,"Rybelsus")~"Rybelsus",
str_detect(bnf_name,"Wegovy")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.19ml inj 1.5ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.37ml inj 1.5ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.37ml inj 1.5ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1.7mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1.7mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"1mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"Semaglutide 1mg/0.75ml inj 3ml pre-filled disposable devices")~"Wegovy",
str_detect(bnf_name,"1mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"2.4mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"2.4mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.19ml inj 1.5ml pre-filled pens")~"Ozempic",
str_detect(bnf_name,"0.5mg/0.37ml inj 1.5ml pre-filled pens")~"Ozempic / Wegovy",
str_detect(bnf_name,"0.5mg/0.37ml inj 1.5ml pf dispos dev")~"Ozempic / Wegovy",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled pens")~"Ozempic",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled disposable devices")~"Ozempic",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled disposable device")~"Ozempic"
)    )
# Check all names have a brand
df_semaglutide %>%
filter(is.na(brand)) %>%
group_by(bnf_name) %>%
summarise() %>%
pull(bnf_name)
df_semaglutide %>%
group_by(drug,region,month) %>%
summarise(group = sum(get(grouping_1))) %>%
drop_na(region)
df_semaglutide %>%
group_by(brand,region,month) %>%
summarise(items = sum(items)) %>%
drop_na(region)
df_semaglutide_plot <- df_semaglutide %>%
group_by(brand,region,month) %>%
summarise(items = sum(items)) %>%
drop_na(region)
semaglutide_plot <- df_semaglutide_plot %>%
ggplot(aes(x = month, y = group, color = brand)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
semaglutide_plot
semaglutide_plot <- df_semaglutide_plot %>%
ggplot(aes(x = month, y = items, color = brand)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
semaglutide_plot
df_semaglutide_region_england <-  df_semaglutide %>%
group_by(brand,month) %>%
summarise(items = sum(items))
df_semaglutide_region_england
df_semaglutide_region_england <-  df_semaglutide %>%
group_by(brand,month) %>%
summarise(items = sum(items),
region = "All England")
df_semaglutide_region <- df_semaglutide %>%
group_by(brand,region,month) %>%
summarise(items = sum(items)) %>%
#combine with all england
bind_rows(df_semaglutide_region_england)
df_semaglutide_region
semaglutide_plot <- df_semaglutide_plot %>%
ggplot(aes(x = month, y = items, color = brand)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
semaglutide_plot
df_semaglutide_region <- df_semaglutide %>%
group_by(brand,region,month) %>%
summarise(items = sum(items)) %>%
#combine with all england
bind_rows(df_semaglutide_region_england)
semaglutide_plot <- df_semaglutide_plot %>%
ggplot(aes(x = month, y = items, color = brand)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
semaglutide_plot
df_semaglutide_region
View(df_semaglutide_region)
semaglutide_plot <- df_semaglutide_plot %>%
ggplot(aes(x = month, y = items, color = brand)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
semaglutide_plot
library(scales)
library(readr)
library('tidyverse')
library('sf')
library(ggplot2)
library(stringr)
library(here)
library("glue")
# read OP data
df_input <- read_csv(here::here("data","vtm_matched.csv"))
# combine with region name
df_regions <- read_csv(here::here("data","NHS_England_Names_and_Codes_in_England.csv")) %>%
rename(regional_team = NHSER24CDH ,region = NHSER24NM) %>%
select(regional_team,region)
df_input <- df_input %>%
left_join(df_regions)
### filter out tablets (note Rybelsus only available in tablet form)
df_semaglutide <- df_input %>%
filter(drug=="Semaglutide") %>%
filter(!str_detect(bnf_name,"tablet"))
df_semaglutide_names <- df_semaglutide %>%
group_by(bnf_name) %>%
summarise() %>%
pull(bnf_name)
#### referencing against OP dmd browser https://openprescribing.net/dmd/?q=0601023AW to find brand
#### note 0.5mg/0.37ml inj 1.5ml can be either Ozempic or Wegovy
df_semaglutide <- df_semaglutide %>%
mutate(brand = case_when(
str_detect(bnf_name,"Ozempic")~"Ozempic",
str_detect(bnf_name,"Rybelsus")~"Rybelsus",
str_detect(bnf_name,"Wegovy")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.19ml inj 1.5ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.37ml inj 1.5ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.37ml inj 1.5ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1.7mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1.7mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"1mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"Semaglutide 1mg/0.75ml inj 3ml pre-filled disposable devices")~"Wegovy",
str_detect(bnf_name,"1mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"2.4mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"2.4mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.19ml inj 1.5ml pre-filled pens")~"Ozempic",
str_detect(bnf_name,"0.5mg/0.37ml inj 1.5ml pre-filled pens")~"Ozempic / Wegovy",
str_detect(bnf_name,"0.5mg/0.37ml inj 1.5ml pf dispos dev")~"Ozempic / Wegovy",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled pens")~"Ozempic",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled disposable devices")~"Ozempic",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled disposable device")~"Ozempic"
)    )
# Check all names have a brand
df_semaglutide %>%
filter(is.na(brand)) %>%
group_by(bnf_name) %>%
summarise() %>%
pull(bnf_name)
df_semaglutide_region_england <-  df_semaglutide %>%
group_by(brand,month) %>%
summarise(items = sum(items),
region = "All England")
df_semaglutide_region <- df_semaglutide %>%
group_by(brand,region,month) %>%
summarise(items = sum(items)) %>%
#combine with all england
bind_rows(df_semaglutide_region_england)
semaglutide_plot <- df_semaglutide_plot %>%
ggplot(aes(x = month, y = items, color = brand)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
ggsave(
filename = here::here(
"output",
"items",
glue("semaglutide_brand_by_region_plot.png")),
semaglutide_plot,
dpi = 600,
width = 45,
height = 30,
units = "cm"
)
df_semaglutide_region <- df_semaglutide %>%
group_by(brand,region,month) %>%
summarise(items = sum(items))
semaglutide_plot <- df_semaglutide_plot %>%
ggplot(aes(x = month, y = items, color = brand)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
ggsave(
filename = here::here(
"output",
"items",
glue("semaglutide_brand_by_region_plot.png")),
semaglutide_plot,
dpi = 600,
width = 45,
height = 30,
units = "cm"
)
semaglutide_brand_plot <- df_semaglutide_region_england %>%
ggplot(aes(x = month, y = items, color = brand)) +
geom_line() +
scale_y_continuous(labels = label_comma())
library(scales)
library(readr)
library('tidyverse')
library('sf')
library(ggplot2)
library(stringr)
library(here)
library("glue")
# read OP data
df_input <- read_csv(here::here("data","vtm_matched.csv"))
# combine with region name
df_regions <- read_csv(here::here("data","NHS_England_Names_and_Codes_in_England.csv")) %>%
rename(regional_team = NHSER24CDH ,region = NHSER24NM) %>%
select(regional_team,region)
df_input <- df_input %>%
left_join(df_regions)
### filter out tablets (note Rybelsus only available in tablet form)
df_semaglutide <- df_input %>%
filter(drug=="Semaglutide") %>%
filter(!str_detect(bnf_name,"tablet"))
df_semaglutide_names <- df_semaglutide %>%
group_by(bnf_name) %>%
summarise() %>%
pull(bnf_name)
#### referencing against OP dmd browser https://openprescribing.net/dmd/?q=0601023AW to find brand
#### note 0.5mg/0.37ml inj 1.5ml can be either Ozempic or Wegovy
df_semaglutide <- df_semaglutide %>%
mutate(brand = case_when(
str_detect(bnf_name,"Ozempic")~"Ozempic",
str_detect(bnf_name,"Rybelsus")~"Rybelsus",
str_detect(bnf_name,"Wegovy")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.19ml inj 1.5ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.37ml inj 1.5ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.37ml inj 1.5ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1.7mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"1.7mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"1mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"Semaglutide 1mg/0.75ml inj 3ml pre-filled disposable devices")~"Wegovy",
str_detect(bnf_name,"1mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"2.4mg/0.75ml inj 3ml pre-filled pens")~"Wegovy",
str_detect(bnf_name,"2.4mg/0.75ml inj 3ml pf dispos dev")~"Wegovy",
str_detect(bnf_name,"0.25mg/0.19ml inj 1.5ml pre-filled pens")~"Ozempic",
str_detect(bnf_name,"0.5mg/0.37ml inj 1.5ml pre-filled pens")~"Ozempic / Wegovy",
str_detect(bnf_name,"0.5mg/0.37ml inj 1.5ml pf dispos dev")~"Ozempic / Wegovy",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled pens")~"Ozempic",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled disposable devices")~"Ozempic",
str_detect(bnf_name,"1mg/0.74ml inj 3ml pre-filled disposable device")~"Ozempic"
)    )
# Check all names have a brand
df_semaglutide %>%
filter(is.na(brand)) %>%
group_by(bnf_name) %>%
summarise() %>%
pull(bnf_name)
df_semaglutide_region_england <-  df_semaglutide %>%
group_by(brand,month) %>%
summarise(items = sum(items),
region = "All England")
semaglutide_brand_plot <- df_semaglutide_region_england %>%
ggplot(aes(x = month, y = items, color = brand)) +
geom_line() +
scale_y_continuous(labels = label_comma())
ggsave(
filename = here::here(
"output",
"items",
glue("semaglutide_brand_plot.png")),
semaglutide_brand_plot,
dpi = 600,
width = 25,
height = 15,
units = "cm"
)
df_semaglutide_region <- df_semaglutide %>%
group_by(brand,region,month) %>%
summarise(items = sum(items))
semaglutide_brand_by_region_plot <- df_semaglutide_plot %>%
ggplot(aes(x = month, y = items, color = brand)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
semaglutide_brand_by_region_plot <- df_semaglutide_region %>%
ggplot(aes(x = month, y = items, color = brand)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
ggsave(
filename = here::here(
"output",
"items",
glue("semaglutide_brand_by_region_plot.png")),
semaglutide_brand_by_region_plot,
dpi = 600,
width = 45,
height = 30,
units = "cm"
)
df_input <- read_csv(here::here("data","vtm_matched.csv"))
View(df_input )
df_input <- read_csv(here::here("data","vtm_matched.csv"))
#### just wegovy
df_wegovy_region <- df_semaglutide %>%
group_by(brand,region,month) %>%
filter(brand == "Wegovy")
#### just wegovy
df_wegovy_region <- df_semaglutide %>%
group_by(brand,region,month) %>%
filter(brand == "Wegovy") %>%
summarise(items = sum(items))
wegovy_brand_by_region_plot <- df_wegovy_region %>%
ggplot(aes(x = month, y = items)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
ggsave(
filename = here::here(
"output",
"items",
glue("wegovy_brand_by_region_plot.png")),
semaglutide_brand_by_region_plot,
dpi = 600,
width = 45,
height = 30,
units = "cm"
)
ggsave(
filename = here::here(
"output",
"items",
glue("wegovy_brand_by_region_plot.png")),
wegovy_brand_by_region_plot,
dpi = 600,
width = 45,
height = 30,
units = "cm"
)
semaglutide_dates<- tibble(dates=as.Date(c("2022-06-01","2023-03-01","2023-09-01")),
label = c("Final\nappraisal\ndocument","Published","Updated"),
alpha = c(0.2,0.3,0.4),
colour = "#00468BFF")
wegovy_brand_by_region_plot <- df_wegovy_region %>%
ggplot(aes(x = month, y = items)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())  +
geom_vline(xintercept = semaglutide_dates$dates,
alpha = semaglutide_dates$alpha,
colour = semaglutide_dates$colour)
ggsave(
filename = here::here(
"output",
"items",
glue("wegovy_brand_by_region_plot.png")),
wegovy_brand_by_region_plot,
dpi = 600,
width = 45,
height = 30,
units = "cm"
)
wegovy_brand_by_region_plot <- df_wegovy_region %>%
ggplot(aes(x = month, y = items)) +
geom_vline(xintercept = semaglutide_dates$dates,
alpha = semaglutide_dates$alpha,
colour = semaglutide_dates$colour) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
ggsave(
filename = here::here(
"output",
"items",
glue("wegovy_brand_by_region_plot.png")),
wegovy_brand_by_region_plot,
dpi = 600,
width = 45,
height = 30,
units = "cm"
)
wegovy_brand_by_region_plot <- df_wegovy_region %>%
ggplot(aes(x = month, y = items)) +
geom_line() +
facet_wrap(~ region, ncol = 3)  +
scale_y_continuous(labels = label_comma())
ggsave(
filename = here::here(
"output",
"items",
glue("wegovy_brand_by_region_plot.png")),
wegovy_brand_by_region_plot,
dpi = 600,
width = 45,
height = 30,
units = "cm"
)
